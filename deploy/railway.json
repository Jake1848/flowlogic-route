{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKER",
    "dockerfilePath": "docker/Dockerfile.api"
  },
  "deploy": {
    "startCommand": "/entrypoint.sh",
    "healthcheckPath": "/health",
    "healthcheckTimeout": 30,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  },
  "environments": {
    "production": {
      "variables": {
        "ENVIRONMENT": "production",
        "CREATE_ADMIN": "true"
      },
      "secrets": [
        "DATABASE_URL",
        "ASYNC_DATABASE_URL", 
        "REDIS_URL",
        "FIREBASE_SERVICE_ACCOUNT_JSON",
        "STRIPE_SECRET_KEY",
        "STRIPE_WEBHOOK_SECRET",
        "STRIPE_PRICE_STARTER",
        "STRIPE_PRICE_PROFESSIONAL", 
        "STRIPE_PRICE_ENTERPRISE",
        "ADMIN_EMAIL",
        "ADMIN_FIREBASE_UID",
        "OPENAI_API_KEY",
        "GRAPHHOPPER_API_KEY"
      ]
    }
  },
  "services": {
    "postgres": {
      "image": "postgres:15-alpine",
      "variables": {
        "POSTGRES_DB": "flowlogic",
        "POSTGRES_USER": "postgres"
      },
      "secrets": ["POSTGRES_PASSWORD"],
      "volumes": [{
        "mountPath": "/var/lib/postgresql/data",
        "size": "10GB"
      }]
    },
    "redis": {
      "image": "redis:7-alpine",
      "command": "redis-server --appendonly yes --maxmemory 256mb --maxmemory-policy allkeys-lru",
      "volumes": [{
        "mountPath": "/data", 
        "size": "1GB"
      }]
    }
  },
  "networking": {
    "publicPort": 8001,
    "internalPorts": [8000, 8001]
  }
}